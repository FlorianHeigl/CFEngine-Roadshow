bundle agent etc_hosts {

vars:
 "hosts[ips-roadshow]" string => "10.168.0.1";
 "hosts[inuc-01]"      string => "10.168.0.7";
 "hosts[dell-lat]"     string => "10.168.0.9";
 "hosts[cfeutl01]"     string => "10.168.0.10";
 "hosts[aptutl01]"     string => "10.168.0.11";
 "hosts[nfsutl01]"     string => "10.168.0.12";
 "hosts[mnmutl0015]"   string => "10.168.0.15";
 "hosts[webapp0180]"   string => "10.168.1.180";
 "hosts[webapp0181]"   string => "10.168.1.181";
 "hosts[webttw0182]"   string => "10.168.1.182";
 "hosts[webttw0183]"   string => "10.168.1.183";
 "hosts[webhud0184]"   string => "10.168.1.184";
 "hosts[webhud0185]"   string => "10.168.1.185";
 "hosts[aptutl0211]"   string => "10.168.2.11";
 "hosts[nfsutl0212]"   string => "10.168.2.12";

#aptubu01.webhuis.nl.sh:export ip="10.68.71.22"
#cfeutl0010.webhuis.nl.sh:export ip="10.168.1.10"
#mifutl0014.webhuis.nl.sh:export ip="10.168.0.14"

 "host_index"           slist => getindices("$(hosts)");

files:
  "/etc/hosts"
  comment                   => "/etc/hosts voor elke host",
  create                    => "true",
  perms                     => mo("644","root"),
  edit_line                 => edit_etc_hosts("etc_hosts.hosts"),
  action                    => u_immediate;

}

bundle edit_line edit_etc_hosts(hosts) {

vars:
 "host_index"            slist => getindices("$(hosts)");

delete_lines:

    ".*";

insert_lines:

"# Webhuis /etc/hosts voor de roadshow
#
# Do not edit
#
127.0.0.1       localhost

${sys.ipv4} ${sys.fqhost} ${sys.uqhost}

$($(hosts)[$(host_index)]) $(host_index).${sys.domain} $(host_index)

10.68.71.181    mirror.webhuis.nl mirror

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters";

}

